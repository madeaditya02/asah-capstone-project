From d3f375266e0e30d4069b97e50c6640f4fba2b84f Mon Sep 17 00:00:00 2001
From: asakarso <asaprameswaru@gmail.com>
Date: Mon, 24 Nov 2025 11:35:25 +0800
Subject: [PATCH 4/7] add migration for create notes and status table

---
 database.json                                 |  9 ++++
 .../20251124025417-create-catatan-table.js    | 53 +++++++++++++++++++
 .../20251124033021-create-status-table.js     | 53 +++++++++++++++++++
 ...251124025417-create-catatan-table-down.sql |  1 +
 ...20251124025417-create-catatan-table-up.sql |  8 +++
 ...0251124033021-create-status-table-down.sql |  1 +
 .../20251124033021-create-status-table-up.sql |  6 +++
 package.json                                  |  6 ++-
 8 files changed, 136 insertions(+), 1 deletion(-)
 create mode 100644 database.json
 create mode 100644 migrations/20251124025417-create-catatan-table.js
 create mode 100644 migrations/20251124033021-create-status-table.js
 create mode 100644 migrations/sqls/20251124025417-create-catatan-table-down.sql
 create mode 100644 migrations/sqls/20251124025417-create-catatan-table-up.sql
 create mode 100644 migrations/sqls/20251124033021-create-status-table-down.sql
 create mode 100644 migrations/sqls/20251124033021-create-status-table-up.sql

diff --git a/database.json b/database.json
new file mode 100644
index 0000000..94a2c2d
--- /dev/null
+++ b/database.json
@@ -0,0 +1,9 @@
+{
+  "dev": {
+    "driver": "mysql",
+    "host": { "ENV": "MYSQL_HOST" },
+    "user": { "ENV": "MYSQL_USER" },
+    "password": { "ENV": "MYSQL_PASSWORD" },
+    "database": { "ENV": "MYSQL_DB" }
+  }
+}
diff --git a/migrations/20251124025417-create-catatan-table.js b/migrations/20251124025417-create-catatan-table.js
new file mode 100644
index 0000000..e88e905
--- /dev/null
+++ b/migrations/20251124025417-create-catatan-table.js
@@ -0,0 +1,53 @@
+'use strict';
+
+var dbm;
+var type;
+var seed;
+var fs = require('fs');
+var path = require('path');
+var Promise;
+
+/**
+  * We receive the dbmigrate dependency from dbmigrate initially.
+  * This enables us to not have to rely on NODE_PATH.
+  */
+exports.setup = function(options, seedLink) {
+  dbm = options.dbmigrate;
+  type = dbm.dataType;
+  seed = seedLink;
+  Promise = options.Promise;
+};
+
+exports.up = function(db) {
+  var filePath = path.join(__dirname, 'sqls', '20251124025417-create-catatan-table-up.sql');
+  return new Promise( function( resolve, reject ) {
+    fs.readFile(filePath, {encoding: 'utf-8'}, function(err,data){
+      if (err) return reject(err);
+      console.log('received data: ' + data);
+
+      resolve(data);
+    });
+  })
+  .then(function(data) {
+    return db.runSql(data);
+  });
+};
+
+exports.down = function(db) {
+  var filePath = path.join(__dirname, 'sqls', '20251124025417-create-catatan-table-down.sql');
+  return new Promise( function( resolve, reject ) {
+    fs.readFile(filePath, {encoding: 'utf-8'}, function(err,data){
+      if (err) return reject(err);
+      console.log('received data: ' + data);
+
+      resolve(data);
+    });
+  })
+  .then(function(data) {
+    return db.runSql(data);
+  });
+};
+
+exports._meta = {
+  "version": 1
+};
diff --git a/migrations/20251124033021-create-status-table.js b/migrations/20251124033021-create-status-table.js
new file mode 100644
index 0000000..665c819
--- /dev/null
+++ b/migrations/20251124033021-create-status-table.js
@@ -0,0 +1,53 @@
+'use strict';
+
+var dbm;
+var type;
+var seed;
+var fs = require('fs');
+var path = require('path');
+var Promise;
+
+/**
+  * We receive the dbmigrate dependency from dbmigrate initially.
+  * This enables us to not have to rely on NODE_PATH.
+  */
+exports.setup = function(options, seedLink) {
+  dbm = options.dbmigrate;
+  type = dbm.dataType;
+  seed = seedLink;
+  Promise = options.Promise;
+};
+
+exports.up = function(db) {
+  var filePath = path.join(__dirname, 'sqls', '20251124033021-create-status-table-up.sql');
+  return new Promise( function( resolve, reject ) {
+    fs.readFile(filePath, {encoding: 'utf-8'}, function(err,data){
+      if (err) return reject(err);
+      console.log('received data: ' + data);
+
+      resolve(data);
+    });
+  })
+  .then(function(data) {
+    return db.runSql(data);
+  });
+};
+
+exports.down = function(db) {
+  var filePath = path.join(__dirname, 'sqls', '20251124033021-create-status-table-down.sql');
+  return new Promise( function( resolve, reject ) {
+    fs.readFile(filePath, {encoding: 'utf-8'}, function(err,data){
+      if (err) return reject(err);
+      console.log('received data: ' + data);
+
+      resolve(data);
+    });
+  })
+  .then(function(data) {
+    return db.runSql(data);
+  });
+};
+
+exports._meta = {
+  "version": 1
+};
diff --git a/migrations/sqls/20251124025417-create-catatan-table-down.sql b/migrations/sqls/20251124025417-create-catatan-table-down.sql
new file mode 100644
index 0000000..d5dbfff
--- /dev/null
+++ b/migrations/sqls/20251124025417-create-catatan-table-down.sql
@@ -0,0 +1 @@
+DROP TABLE catatan;
\ No newline at end of file
diff --git a/migrations/sqls/20251124025417-create-catatan-table-up.sql b/migrations/sqls/20251124025417-create-catatan-table-up.sql
new file mode 100644
index 0000000..63ac267
--- /dev/null
+++ b/migrations/sqls/20251124025417-create-catatan-table-up.sql
@@ -0,0 +1,8 @@
+CREATE TABLE catatan (
+  id_catatan VARCHAR(50) PRIMARY KEY,
+  deskripsi_catatan TEXT NOT NULL,
+  waktu_dihubungi DATETIME NOT NULL,
+  durasi TIME NULL,
+  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
+  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
+);
\ No newline at end of file
diff --git a/migrations/sqls/20251124033021-create-status-table-down.sql b/migrations/sqls/20251124033021-create-status-table-down.sql
new file mode 100644
index 0000000..23a438a
--- /dev/null
+++ b/migrations/sqls/20251124033021-create-status-table-down.sql
@@ -0,0 +1 @@
+DROP TABLE status;
\ No newline at end of file
diff --git a/migrations/sqls/20251124033021-create-status-table-up.sql b/migrations/sqls/20251124033021-create-status-table-up.sql
new file mode 100644
index 0000000..d9c9853
--- /dev/null
+++ b/migrations/sqls/20251124033021-create-status-table-up.sql
@@ -0,0 +1,6 @@
+CREATE TABLE status (
+  id_status VARCHAR(50) PRIMARY KEY,
+  nama_status VARCHAR(50) NOT NULL,
+  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
+  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
+);
\ No newline at end of file
diff --git a/package.json b/package.json
index b3ef7fd..944cade 100644
--- a/package.json
+++ b/package.json
@@ -4,7 +4,11 @@
   "description": "",
   "main": "index.js",
   "scripts": {
-    "test": "echo \"Error: no test specified\" && exit 1"
+    "test": "echo \"Error: no test specified\" && exit 1",
+    
+    "migrate:create": "db-migrate create",
+    "migrate:up": "db-migrate up",
+    "migrate:down": "db-migrate down"
   },
   "keywords": [],
   "author": "",
-- 
2.43.0.windows.1

